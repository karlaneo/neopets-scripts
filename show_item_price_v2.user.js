// ==UserScript==
// @name         Neopets - Karla's item price display V2
// @namespace    karla@neopointskarla
// @license      GPL3
// @version      0.0.1
// @description  Display item price from itemdb
// @author       Karla
// @match        *://*.neopets.com/safetydeposit*
// @match        *://*.neopets.com/auctions*
// @homepage     https://neopointskarla.com
// @icon         https://github.com/karlaneo/neopets-scripts/blob/main/favicon-32x32.png?raw=true
// @grant        GM.xmlHttpRequest
// @downloadURL  https://github.com/karlaneo/neopets-scripts/raw/refs/heads/main/show_item_price_v2.user.js
// @updateURL    https://github.com/karlaneo/neopets-scripts/raw/refs/heads/main/show_item_price_v2.user.js
// ==/UserScript==

function a0_0x4e22(){const _0x7a2b07=['parse','POST','ncPrice','itemImgId','center','split','xmlHttpRequest','#ff595e','price','application/json','783320psaoXp','ncValue','toFixed','form\x20~\x20tr','log','8IdDvWU','img','innerHTML','align','textContent','571665WaaFGE','<b>Unit\x20Price</b>','colspan','toString','\x20NP','createElement','</b>','#dddd77','replace','Unit\x20Price','https://itemdb.com.br/api/v1/items/many','textAlign','insertBefore','slice','forEach','#ffbe0b','toLowerCase','right','18sbhxlR','style','map','250','1020480MmMgvk','add','bgcolor','width','452074mUHMdE','2087766bUZLSj','from','filter','src','<b>','includes','value','itemName','[colspan=\x226\x22]','href','pop','Request\x20failed:','querySelector','setAttribute','querySelectorAll','741335yxfuMC','stringify','33348PpImeN'];a0_0x4e22=function(){return _0x7a2b07;};return a0_0x4e22();}(function(_0x1c7c98,_0x7dfcf9){const _0x53fedc=a0_0x4568,_0x491ac4=_0x1c7c98();while(!![]){try{const _0xe58bfc=-parseInt(_0x53fedc(0x1b0))/0x1+-parseInt(_0x53fedc(0x1df))/0x2+parseInt(_0x53fedc(0x1c5))/0x3+-parseInt(_0x53fedc(0x1c0))/0x4*(-parseInt(_0x53fedc(0x1bb))/0x5)+parseInt(_0x53fedc(0x1d7))/0x6*(parseInt(_0x53fedc(0x1ef))/0x7)+-parseInt(_0x53fedc(0x1db))/0x8+-parseInt(_0x53fedc(0x1e0))/0x9;if(_0xe58bfc===_0x7dfcf9)break;else _0x491ac4['push'](_0x491ac4['shift']());}catch(_0x2d0016){_0x491ac4['push'](_0x491ac4['shift']());}}}(a0_0x4e22,0x317b7));function formatNumber(_0x47e99d){const _0x3135af=a0_0x4568;if(_0x47e99d>=0x3b9aca00)return(_0x47e99d/0x3b9aca00)['toFixed'](0x1)[_0x3135af(0x1cd)](/\.0$/,'')+'b';else{if(_0x47e99d>=0xf4240)return(_0x47e99d/0xf4240)['toFixed'](0x1)['replace'](/\.0$/,'')+'m';else return _0x47e99d>=0x3e8?(_0x47e99d/0x3e8)[_0x3135af(0x1bd)](0x1)[_0x3135af(0x1cd)](/\.0$/,'')+'k':_0x47e99d[_0x3135af(0x1c8)]();}}const fetchItemData=async _0x417c00=>{const _0x5d249f=a0_0x4568,_0x39698e=await new Promise((_0xc538ce,_0xdae344)=>{const _0x4dc2c2=a0_0x4568;GM[_0x4dc2c2(0x1b7)]({'method':_0x4dc2c2(0x1b2),'url':_0x4dc2c2(0x1cf),'headers':{'Content-Type':_0x4dc2c2(0x1ba)},'data':JSON[_0x4dc2c2(0x1f0)]({'name_image_id':_0x417c00[_0x4dc2c2(0x1d9)](_0x4a4750=>[_0x4a4750[_0x4dc2c2(0x1e7)],_0x4a4750[_0x4dc2c2(0x1b4)]])}),'onload':function(_0xbcc393){const _0x21fdaf=_0x4dc2c2;_0xc538ce(JSON[_0x21fdaf(0x1b1)](_0xbcc393['responseText']));},'onerror':function(_0x31a32f){const _0x231eae=_0x4dc2c2;_0xdae344(_0x231eae(0x1eb),_0x31a32f);}});}),_0x5655ff=_0x417c00[_0x5d249f(0x1d9)](_0x316624=>({..._0x316624,'price':_0x39698e[encodeURIComponent(_0x316624[_0x5d249f(0x1e7)])[_0x5d249f(0x1d5)]()+'_'+_0x316624[_0x5d249f(0x1b4)]]?.[_0x5d249f(0x1b9)]?.[_0x5d249f(0x1e6)]||0x0,'ncPrice':_0x39698e[encodeURIComponent(_0x316624[_0x5d249f(0x1e7)])[_0x5d249f(0x1d5)]()+'_'+_0x316624[_0x5d249f(0x1b4)]]?.[_0x5d249f(0x1bc)]?.['range']}));return _0x5655ff;};function a0_0x4568(_0x170e9f,_0x4d09a9){_0x170e9f=_0x170e9f-0x1b0;const _0x4e22a7=a0_0x4e22();let _0x4568d9=_0x4e22a7[_0x170e9f];return _0x4568d9;}(async function(){'use strict';const _0x30eed4=a0_0x4568;const _0x178c98=window['location'][_0x30eed4(0x1e9)];try{if(_0x178c98['includes']('/safetydeposit')){const _0x163f17=document[_0x30eed4(0x1ec)]('form\x20table\x20~\x20table');Array[_0x30eed4(0x1e1)](_0x163f17[_0x30eed4(0x1ee)]('[width=\x22350\x22]'))[_0x30eed4(0x1d9)](_0x4763fb=>{const _0x26daeb=_0x30eed4;_0x4763fb[_0x26daeb(0x1de)]=_0x26daeb(0x1da);}),_0x163f17[_0x30eed4(0x1ec)](_0x30eed4(0x1e8))[_0x30eed4(0x1c7)]='7';const _0x4ecafd=document[_0x30eed4(0x1ca)]('td');_0x4ecafd[_0x30eed4(0x1c3)]='center',_0x4ecafd['classList'][_0x30eed4(0x1dc)]('contentModuleHeaderAlt'),_0x4ecafd['style'][_0x30eed4(0x1d0)]='center',_0x4ecafd['textContent']=_0x30eed4(0x1ce),_0x4ecafd['width']='100';const _0xef5a99=_0x163f17[_0x30eed4(0x1ec)]('tr')[_0x30eed4(0x1ee)]('td')[0x5]||null;_0x163f17[_0x30eed4(0x1ec)]('tr')[_0x30eed4(0x1d1)](_0x4ecafd,_0xef5a99);const _0x3aa400=_0x163f17['querySelectorAll'](_0x30eed4(0x1be)),_0x43aa8f=Array[_0x30eed4(0x1e1)](_0x3aa400)[_0x30eed4(0x1d9)](_0x2b5f15=>({'itemName':_0x2b5f15[_0x30eed4(0x1ee)]('td')[0x1]?.['textContent']?.[_0x30eed4(0x1b6)]('(')?.[0x0],'itemImg':_0x2b5f15[_0x30eed4(0x1ee)]('td')[0x0]?.[_0x30eed4(0x1ec)]('img')?.[_0x30eed4(0x1e3)],'itemImgId':_0x2b5f15[_0x30eed4(0x1ee)]('td')[0x0]?.[_0x30eed4(0x1ec)](_0x30eed4(0x1c1))?.[_0x30eed4(0x1e3)]?.[_0x30eed4(0x1b6)]('/')[_0x30eed4(0x1ea)]()[_0x30eed4(0x1b6)]('.')[0x0],'el':_0x2b5f15}))[_0x30eed4(0x1e2)](_0x3f6c70=>_0x3f6c70[_0x30eed4(0x1e7)]),_0x24a5ad=await fetchItemData(_0x43aa8f);_0x24a5ad[_0x30eed4(0x1d3)](_0x179d69=>{const _0x374ca5=_0x30eed4,_0x1907c5=document[_0x374ca5(0x1ca)]('td');_0x1907c5[_0x374ca5(0x1d8)][_0x374ca5(0x1d0)]=_0x374ca5(0x1d6),_0x1907c5[_0x374ca5(0x1c2)]=_0x179d69[_0x374ca5(0x1b3)]?'<b>'+_0x179d69[_0x374ca5(0x1b3)]+'\x20caps</b>':_0x374ca5(0x1e4)+(_0x179d69[_0x374ca5(0x1b9)]?formatNumber(_0x179d69[_0x374ca5(0x1b9)]):'?')+_0x374ca5(0x1cb);const _0x3a0189=_0x179d69['el']['querySelectorAll']('td')[0x5]||null;_0x179d69['el'][_0x374ca5(0x1d1)](_0x1907c5,_0x3a0189);});const _0x48f766=document[_0x30eed4(0x1ca)]('td');console[_0x30eed4(0x1bf)](_0x48f766),Array[_0x30eed4(0x1e1)](_0x163f17[_0x30eed4(0x1ee)]('tr'))[_0x30eed4(0x1ea)]()['prepend'](_0x48f766);}else{if(_0x178c98[_0x30eed4(0x1e5)]('/auctions')){const _0x3adb27=document['querySelector']('center\x20+\x20table'),_0x40f3c6=document[_0x30eed4(0x1ca)]('td');_0x40f3c6['align']=_0x30eed4(0x1b5),_0x40f3c6[_0x30eed4(0x1ed)](_0x30eed4(0x1dd),_0x30eed4(0x1cc)),_0x40f3c6[_0x30eed4(0x1d8)][_0x30eed4(0x1d0)]=_0x30eed4(0x1b5),_0x40f3c6['innerHTML']=_0x30eed4(0x1c6);const _0x108c24=_0x3adb27[_0x30eed4(0x1ec)]('tr')[_0x30eed4(0x1ee)]('td')[0x2]||null;_0x3adb27[_0x30eed4(0x1ec)]('tr')[_0x30eed4(0x1d1)](_0x40f3c6,_0x108c24);const _0x57802b=Array[_0x30eed4(0x1e1)](_0x3adb27[_0x30eed4(0x1ee)]('tr'))[_0x30eed4(0x1d2)](0x1),_0x4c6401=_0x57802b['map'](_0x23b539=>({'itemName':_0x23b539[_0x30eed4(0x1ee)]('td')[0x2]?.['textContent'],'itemImg':_0x23b539['querySelectorAll']('td')[0x1]?.[_0x30eed4(0x1ec)](_0x30eed4(0x1c1))?.[_0x30eed4(0x1e3)],'itemImgId':_0x23b539[_0x30eed4(0x1ee)]('td')[0x1]?.[_0x30eed4(0x1ec)](_0x30eed4(0x1c1))?.[_0x30eed4(0x1e3)]?.[_0x30eed4(0x1b6)]('/')['pop']()['split']('.')[0x0],'el':_0x23b539})),_0xc93e44=await fetchItemData(_0x4c6401);_0xc93e44[_0x30eed4(0x1d3)](_0x3d2af5=>{const _0x387827=_0x30eed4,_0x4ab63e=Number(_0x3d2af5['el']['querySelectorAll']('td')[0x6][_0x387827(0x1c4)]['replace'](/,/g,'')[_0x387827(0x1cd)](_0x387827(0x1c9),''));let _0x54530a='';if(_0x3d2af5[_0x387827(0x1b9)]===0x0)_0x54530a=_0x387827(0x1d4);else{if(_0x3d2af5['price']>_0x4ab63e)_0x54530a='#006400';else _0x3d2af5[_0x387827(0x1b9)]<_0x4ab63e&&(_0x54530a=_0x387827(0x1b8));}console[_0x387827(0x1bf)](_0x4ab63e);const _0xfca953=document[_0x387827(0x1ca)]('td');_0xfca953['style']['textAlign']='right',_0xfca953[_0x387827(0x1c2)]=_0x387827(0x1e4)+(_0x3d2af5[_0x387827(0x1b9)]?formatNumber(_0x3d2af5[_0x387827(0x1b9)]):'?')+'</b>',_0xfca953['style']['color']=_0x54530a;const _0x5ab8c9=_0x3d2af5['el'][_0x387827(0x1ee)]('td')[0x3]||null;_0x3d2af5['el']['insertBefore'](_0xfca953,_0x5ab8c9);});}}}catch(_0x4c040e){console['log'](_0x4c040e);}}());
