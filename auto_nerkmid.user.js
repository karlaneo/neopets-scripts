// ==UserScript==
// @name         Neopets - Karla's Nerkmid Autoplayer
// @namespace    karla@neopointskarla
// @license      GPL3
// @version      0.0.1
// @description  Automatically plays Alien Aisha Vending Machine
// @author       Karla
// @match        *://*.neopets.com/vending.phtml*
// @match        *://*.neopets.com/vending2.phtml*
// @match        *://*.neopets.com/vending3.phtml*
// @icon         https://github.com/karlaneo/neopets-scripts/blob/main/favicon-32x32.png?raw=true
// @grant        GM_getValue
// @grant        GM_setValue
// @downloadURL  https://github.com/karlaneo/neopets-scripts/raw/refs/heads/main/auto_nerkmid.user.js
// @updateURL    https://github.com/karlaneo/neopets-scripts/raw/refs/heads/main/auto_nerkmid.user.js
// ==/UserScript==

const a0_0x4100e5=a0_0x1596;function a0_0x1596(_0x869409,_0x503027){const _0x5e1e80=a0_0x5e1e();return a0_0x1596=function(_0x15966f,_0x5d7fe7){_0x15966f=_0x15966f-0x15f;let _0x4f335d=_0x5e1e80[_0x15966f];return _0x4f335d;},a0_0x1596(_0x869409,_0x503027);}(function(_0xcdad4d,_0x140faf){const _0x548572=a0_0x1596,_0x8229c0=_0xcdad4d();while(!![]){try{const _0x5089ab=parseInt(_0x548572(0x198))/0x1+parseInt(_0x548572(0x1c3))/0x2+-parseInt(_0x548572(0x1a0))/0x3+-parseInt(_0x548572(0x189))/0x4+parseInt(_0x548572(0x1be))/0x5*(-parseInt(_0x548572(0x18e))/0x6)+-parseInt(_0x548572(0x188))/0x7+parseInt(_0x548572(0x16b))/0x8;if(_0x5089ab===_0x140faf)break;else _0x8229c0['push'](_0x8229c0['shift']());}catch(_0x378772){_0x8229c0['push'](_0x8229c0['shift']());}}}(a0_0x5e1e,0x34199));let playing=GM_getValue(a0_0x4100e5(0x15f))||![],maxNP=GM_getValue('aavm_max_np')||![],restock=GM_getValue(a0_0x4100e5(0x1cd))||![],currentHS=GM_getValue(a0_0x4100e5(0x1c9))||'0',timeout;const sleep=_0x66630c=>new Promise(_0x13d36f=>setTimeout(_0x13d36f,_0x66630c)),random_in_range=(_0x530997,_0x10d957)=>{const _0x551d8a=a0_0x4100e5;return Math[_0x551d8a(0x192)](Math[_0x551d8a(0x1ac)]()*(_0x10d957-_0x530997+0x1)+_0x530997);},nerkmids=[a0_0x4100e5(0x1b2),a0_0x4100e5(0x169),'Basic\x20Golden\x20Nerkmid',a0_0x4100e5(0x1b5),a0_0x4100e5(0x1ae),a0_0x4100e5(0x180),a0_0x4100e5(0x171),'Good\x20Nerkmid',a0_0x4100e5(0x1ca),'Magical\x20Golden\x20Nerkmid',a0_0x4100e5(0x18d),a0_0x4100e5(0x1a6),a0_0x4100e5(0x1c5),a0_0x4100e5(0x16c),'Super\x20Nerkmid',a0_0x4100e5(0x1b0),'Ultra\x20Golden\x20Nerkmid',a0_0x4100e5(0x161),a0_0x4100e5(0x199)];async function buyItem(_0x2ab537){const _0x1327e4=a0_0x4100e5;let _0x41a616=[];for(let _0x1f9de1=0x0;_0x1f9de1<0x5;_0x1f9de1+=0x1){const _0x3a8fc6=await fetch('https://www.neopets.com/np-templates/ajax/wizard.php',{'headers':{'accept':_0x1327e4(0x1ba),'accept-language':_0x1327e4(0x165),'content-type':'application/x-www-form-urlencoded;\x20charset=UTF-8','x-requested-with':_0x1327e4(0x162)},'referrer':_0x1327e4(0x1c1),'referer':_0x1327e4(0x1c1),'referrerPolicy':_0x1327e4(0x19a),'body':_0x1327e4(0x1c2)+encodeURIComponent(_0x2ab537)+_0x1327e4(0x1c6),'method':_0x1327e4(0x19f),'mode':_0x1327e4(0x17c),'credentials':_0x1327e4(0x173)})['then'](_0x1d78a4=>_0x1d78a4['text']());let _0x5b0ccf=new DOMParser(),_0x46d14f=_0x5b0ccf['parseFromString'](_0x3a8fc6,'text/html');if(_0x3a8fc6['includes'](_0x1327e4(0x1b3))){const _0x244ab0=_0x46d14f['querySelector']('.wizard-char.wizard-char-single.wizard-char-old\x20+\x20p\x20+\x20p')[_0x1327e4(0x194)],_0x273dc5=Number(_0x244ab0[_0x1327e4(0x1ad)]('I\x20am\x20too\x20busy\x20right\x20now,\x20please\x20come\x20back\x20in\x20about\x20','')[_0x1327e4(0x1ad)](_0x1327e4(0x164),''));if(_0x41a616[_0x1327e4(0x182)]>0x0)break;else{await sleep((_0x273dc5+0x2)*0x3c*0x3e8),_0x1f9de1-=0x1;continue;}}const _0x1444eb=_0x46d14f['querySelectorAll'](_0x1327e4(0x17f));for(let _0x48de7d=0x0;_0x48de7d<_0x1444eb[_0x1327e4(0x182)];_0x48de7d+=0x1){const _0xa3b970=_0x1444eb[_0x48de7d],_0x2e8c2b=Number(_0xa3b970[_0x1327e4(0x176)](_0x1327e4(0x1bb))[_0x1327e4(0x194)][_0x1327e4(0x174)]()[_0x1327e4(0x1ad)](/,/g,'')[_0x1327e4(0x1ad)](_0x1327e4(0x183),'')),_0x39d5ea=_0xa3b970['querySelector']('a')[_0x1327e4(0x184)];!_0x41a616[_0x1327e4(0x1a1)](_0x483097=>_0x483097[_0x1327e4(0x187)]===_0x39d5ea)&&_0x41a616[_0x1327e4(0x1b8)]({'price':_0x2e8c2b,'link':_0x39d5ea});}_0x1f9de1===0x4&&!_0x41a616[_0x1327e4(0x182)]===0x0&&(_0x1f9de1-=0x1),await sleep(random_in_range(0x2bc,0x4b0));}_0x41a616[_0x1327e4(0x17b)]((_0x17281b,_0x2bd317)=>_0x17281b[_0x1327e4(0x1c0)]-_0x2bd317[_0x1327e4(0x1c0)]);for(let _0x1014c9=0x0;_0x1014c9<_0x41a616[_0x1327e4(0x182)];_0x1014c9+=0x1){const {link:_0x451c99}=_0x41a616[_0x1014c9],_0x58e39d=await fetch(_0x451c99,{'headers':{'accept':_0x1327e4(0x1bf),'Accept-Language':_0x1327e4(0x165)},'referrer':_0x1327e4(0x1c1),'referer':_0x1327e4(0x1c1),'referrerPolicy':_0x1327e4(0x19a),'body':null,'method':_0x1327e4(0x1a7),'mode':'cors','credentials':_0x1327e4(0x173)})['then'](_0x11473d=>_0x11473d['text']())['catch'](_0x23b1c8=>({'error':_0x1327e4(0x1bd),'err':_0x23b1c8}));if(_0x58e39d[_0x1327e4(0x19d)](_0x1327e4(0x18b)))continue;else{if(_0x58e39d['includes'](_0x1327e4(0x18a))){await sleep(0x4b0,0x5dc);continue;}}let _0x49ee3f=new DOMParser(),_0x574037=_0x49ee3f[_0x1327e4(0x18f)](_0x58e39d,_0x1327e4(0x1aa));const _0x3dcfb1=_0x574037['querySelector']('a[href^=\x22buy_item.phtml\x22]')['getAttribute'](_0x1327e4(0x184)),_0x392914=await fetch(_0x1327e4(0x1a3)+_0x3dcfb1,{'headers':{'accept':'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7','accept-language':_0x1327e4(0x165),'sec-ch-ua-mobile':'?0','sec-ch-ua-platform':_0x1327e4(0x17e),'sec-fetch-dest':_0x1327e4(0x1a5),'sec-fetch-mode':_0x1327e4(0x1af),'sec-fetch-site':_0x1327e4(0x195),'sec-fetch-user':'?1','upgrade-insecure-requests':'1'},'referrer':_0x451c99,'referer':_0x451c99,'referrerPolicy':_0x1327e4(0x19a),'body':null,'method':_0x1327e4(0x1a7),'mode':'cors','credentials':_0x1327e4(0x173)})[_0x1327e4(0x191)](_0x4be843=>_0x4be843[_0x1327e4(0x163)]())[_0x1327e4(0x16a)](_0xa4ead1=>({'error':_0x1327e4(0x1bd),'err':_0xa4ead1}));if(_0x392914[_0x1327e4(0x19d)](_0x1327e4(0x1ab))){await sleep(0x4b0,0x5dc);continue;}else{if(_0x392914[_0x1327e4(0x19d)](_0x1327e4(0x1c7)))return _0x1327e4(0x19c);}break;}}async function loop(){timeout=setTimeout(async function(){const _0x3742ff=a0_0x1596;if(document[_0x3742ff(0x176)](_0x3742ff(0x1bc)))document[_0x3742ff(0x176)](_0x3742ff(0x1bc))[_0x3742ff(0x16d)]();else{if(document[_0x3742ff(0x176)]('[name=\x22nerkmid_id\x22]'))document['querySelector']('[name=\x22nerkmid_id\x22]')[_0x3742ff(0x197)]=0x1,await sleep(random_in_range(0x258,0x384)),maxNP?(document['querySelector'](_0x3742ff(0x1b4))[_0x3742ff(0x197)]=0x3,await sleep(random_in_range(0x258,0x384)),document[_0x3742ff(0x176)](_0x3742ff(0x1c8))['selectedIndex']=random_in_range(0x1,0x6),await sleep(random_in_range(0x258,0x384)),document[_0x3742ff(0x176)](_0x3742ff(0x177))[_0x3742ff(0x197)]=random_in_range(0x1,0x5),await sleep(random_in_range(0x258,0x384)),document['querySelector']('[name=\x22lever_pulls\x22]')[_0x3742ff(0x197)]=0x7,await sleep(random_in_range(0x258,0x384))):(document[_0x3742ff(0x176)](_0x3742ff(0x1b4))['selectedIndex']=random_in_range(0x1,0x3),await sleep(random_in_range(0x258,0x384)),document[_0x3742ff(0x176)](_0x3742ff(0x1c8))[_0x3742ff(0x197)]=random_in_range(0x1,0x6),await sleep(random_in_range(0x258,0x384)),document[_0x3742ff(0x176)](_0x3742ff(0x177))[_0x3742ff(0x197)]=random_in_range(0x1,0x5),await sleep(random_in_range(0x258,0x384)),document['querySelector'](_0x3742ff(0x1b7))['selectedIndex']=random_in_range(0x1,0x7),await sleep(random_in_range(0x258,0x384))),document[_0x3742ff(0x176)](_0x3742ff(0x17d))['click']();else{if(document[_0x3742ff(0x176)](_0x3742ff(0x1b6))){const _0x3ce1b6=document[_0x3742ff(0x176)]('p\x20b\x20b')['textContent'];Number(_0x3ce1b6)>Number(currentHS)&&(currentHS=_0x3ce1b6,GM_setValue(_0x3742ff(0x1c9),currentHS),document[_0x3742ff(0x176)](_0x3742ff(0x178))[_0x3742ff(0x193)]=_0x3742ff(0x1b1)+currentHS),window[_0x3742ff(0x16e)]=_0x3742ff(0x1b9);}else{if(document[_0x3742ff(0x176)](_0x3742ff(0x166))){if(restock){const _0x27e37d=maxNP?_0x3742ff(0x168):nerkmids[random_in_range(0x0,nerkmids[_0x3742ff(0x182)]-0x1)],_0x1926bc=await buyItem(_0x27e37d);if(_0x1926bc==='full'){document[_0x3742ff(0x176)](_0x3742ff(0x185))[_0x3742ff(0x193)]='Inventory\x20full,\x20please\x20clear\x20before\x20continuing';return;}window['location']='https://www.neopets.com/vending2.phtml';}}}}}},random_in_range(0x4b0,0x708));}function a0_0x5e1e(){const _0x5f3f1a=['\x20minutes\x20and\x20I\x20can\x20help\x20you\x20out.','en-US','[value=\x22Back\x20to\x20Shops\x20Map\x22]','Stop','Platinum\x20Nerkmid\x20XX','Average\x20Nerkmid','catch','5652248gWQesr','Platinum\x20Nerkmid\x20X','click','location','aavm_max_np','Start','Golden\x20Nerkmid\x20XX','after','include','trim','#k_start','querySelector','[name=\x22button_presses\x22]','#k_message','textAlign','[name=\x22auto_restock\x22]','sort','cors','[value=\x22GO!!!\x22]','\x22Windows\x22','.wizard-results-grid\x20li:not(.wizard-results-grid-header)','Golden\x20Nerkmid\x20X','</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22k_message\x22>Current\x20Highscore:\x20','length','\x20NP','href','#k_error','style','link','82565KmraUj','1313132qXSgvM','Sorry\x20-\x20The\x20owner\x20of\x20this\x20shop\x20has\x20been\x20frozen!','Item\x20not\x20found!','10px','Magical\x20Platinum\x20Nerkmid','418038IlgHNN','parseFromString','[name=\x22max_np\x22]','then','floor','innerHTML','textContent','same-origin','change','selectedIndex','19645ZibGIw','Ultra\x20Platinum\x20Nerkmid','strict-origin-when-cross-origin','log','full','includes','addEventListener','POST','742713QeinrL','find','createElement','https://www.neopets.com/','target','document','Normal\x20Golden\x20Nerkmid','GET','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-bottom:\x2010px\x22>--\x20Alien\x20Aisha\x20Vending\x20Machine\x20Autoplayer\x20--</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20Max\x20NP:\x20<input\x20type=\x22checkbox\x22\x20name=\x22max_np\x22\x20/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20Auto\x20restock\x20Nerkmids:\x20<input\x20type=\x22checkbox\x22\x20name=\x22auto_restock\x22\x20/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22k_start\x22>','disabled','text/html','The\x20item\x20you\x20are\x20trying\x20to\x20buy\x20does\x20not\x20exist\x20in\x20this\x20shop!','random','replace','Copper\x20Nerkmid','navigate','Ultimate\x20Nerkmid','Current\x20Highscore:\x20','Aluminium\x20Nerkmid','Whoa\x20there,\x20too\x20many\x20searches!','[name=\x22large_button\x22]','Basic\x20Platinum\x20Nerkmid','[value=\x22Play\x20Again!\x22]','[name=\x22lever_pulls\x22]','push','https://www.neopets.com/vending2.phtml','text/html,\x20*/*;\x20q=0.01','.wizard-results-price','[value=\x22Press\x20me\x20to\x20Continue!\x22]','error','10pfMCNz','text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7','price','https://www.neopets.com/shops/wizard.phtml','type=process_wizard&feedset=0&shopwizard=','428440KBQbtw','div','Normal\x20Platinum\x20Nerkmid','&table=shop&criteria=exact&min_price=0&max_price=999999','Sorry,\x20you\x20can\x20only\x20carry\x20a\x20maximum','[name=\x22small_button\x22]','aavm_highscore','Lesser\x20Nerkmid','center','[name=\x22Image1\x22],\x20[name=\x22aam\x22],\x20[src=\x22//images.neopets.com/images/noshomatic2.gif\x22]','aavm_restock','playing_aavm','checked','Ultra\x20Nerkmid','XMLHttpRequest','text'];a0_0x5e1e=function(){return _0x5f3f1a;};return a0_0x5e1e();}(function(){'use strict';const _0x36edb7=a0_0x4100e5;try{const _0x2156e1=document[_0x36edb7(0x176)](_0x36edb7(0x1cc))['parentNode'],_0xbc2505=document[_0x36edb7(0x1a2)](_0x36edb7(0x1c4));_0xbc2505[_0x36edb7(0x186)][_0x36edb7(0x179)]=_0x36edb7(0x1cb),_0xbc2505['style']['margin']=_0x36edb7(0x18c),_0xbc2505['innerHTML']=_0x36edb7(0x1a8)+(playing?'Stop':'Start')+_0x36edb7(0x181)+currentHS+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22k_error\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22k_reset\x22>Reset</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x2156e1[_0x36edb7(0x172)](_0xbc2505),_0xbc2505[_0x36edb7(0x176)](_0x36edb7(0x175))[_0x36edb7(0x19e)](_0x36edb7(0x16d),function(_0x2dd7eb){const _0x2b76c6=_0x36edb7;playing=!playing,_0xbc2505['querySelector'](_0x2b76c6(0x190))[_0x2b76c6(0x1a9)]=playing,_0xbc2505[_0x2b76c6(0x176)](_0x2b76c6(0x17a))[_0x2b76c6(0x1a9)]=playing,_0x2dd7eb[_0x2b76c6(0x1a4)][_0x2b76c6(0x193)]=playing?_0x2b76c6(0x167):_0x2b76c6(0x170),!playing?clearTimeout(timeout):loop(),GM_setValue('playing_aavm',playing);}),_0xbc2505['querySelector']('#k_reset')[_0x36edb7(0x19e)](_0x36edb7(0x16d),function(_0x282ea5){const _0x3d1b8d=_0x36edb7;currentHS='0',GM_setValue(_0x3d1b8d(0x1c9),currentHS),document[_0x3d1b8d(0x176)](_0x3d1b8d(0x178))[_0x3d1b8d(0x193)]='Current\x20Highscore:\x20'+currentHS;}),_0xbc2505[_0x36edb7(0x176)](_0x36edb7(0x190))[_0x36edb7(0x160)]=maxNP,_0xbc2505['querySelector'](_0x36edb7(0x190))[_0x36edb7(0x19e)]('change',function(_0x3bc580){const _0x2e448d=_0x36edb7;maxNP=_0x3bc580['target'][_0x2e448d(0x160)],GM_setValue(_0x2e448d(0x16f),maxNP);}),_0xbc2505['querySelector']('[name=\x22max_np\x22]')[_0x36edb7(0x1a9)]=playing,_0xbc2505['querySelector'](_0x36edb7(0x17a))[_0x36edb7(0x160)]=restock,_0xbc2505[_0x36edb7(0x176)](_0x36edb7(0x17a))[_0x36edb7(0x19e)](_0x36edb7(0x196),function(_0x297fef){const _0x333dca=_0x36edb7;restock=_0x297fef[_0x333dca(0x1a4)][_0x333dca(0x160)],GM_setValue(_0x333dca(0x1cd),restock);}),_0xbc2505['querySelector'](_0x36edb7(0x17a))[_0x36edb7(0x1a9)]=playing,playing&&loop();}catch(_0x44fbd6){console[_0x36edb7(0x19b)](_0x44fbd6);}}());
